{% extends 'blog/base.html' %}

{% block content %}
<div class="container mt-3">
    <div class="row">
        <!-- ì¢Œì¸¡: í˜„ì¬ í˜ì´ì§€ ì •ë³´ í‘œì‹œ -->
        <div class="col-md-2 p-0 m-0">
            <div class="p-1">
                <h5>ìŠ¤í„°ë”” ê²Œì‹œíŒ</h5> <!-- í˜„ì¬ í˜ì´ì§€ ì œëª© -->
            </div>
        </div>

        <!-- ìš°ì¸¡: ê²Œì‹œê¸€ ì‘ì„± ì˜ì—­ -->
        <div class="col-md-9 p-0 m-0">
            <div class="p-1">
                <!-- ê²Œì‹œê¸€ ì‘ì„± í¼ -->
                <form method="post" enctype="multipart/form-data" id="postForm">
                    {% csrf_token %}

                    <!-- ì œëª© ì…ë ¥ë€ -->
                    <div class="form-group mb-3">
                        <input type="text" name="title" class="form-control border" placeholder="ì œëª©" required>
                    </div>
                    
                    <!-- ë‚´ìš© ì…ë ¥ë€ (textareaë¡œ ëŒ€ì²´) -->
                    <div class="form-group mb-3">
                        <!-- íˆ´ë°”: Bold, Italic, Underline, Image Upload ë²„íŠ¼ -->
                        <div class="toolbar mb-2">
                            <button type="button" class="btn btn-light" id="boldBtn"><strong>B</strong></button> <!-- êµµê²Œ(Bold) ë²„íŠ¼ -->
                            <button type="button" class="btn btn-light" id="italicBtn"><em>I</em></button> <!-- ê¸°ìš¸ì„(Italic) ë²„íŠ¼ -->
                            <button type="button" class="btn btn-light" id="underlineBtn"><u>U</u></button> <!-- ë°‘ì¤„(Underline) ë²„íŠ¼ -->
                            <button type="button" class="btn btn-light" id="uploadImageBtn">ğŸ“·</button> <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ë²„íŠ¼ -->
                            <input type="file" id="imageInput" accept="image/*" style="display: none;"> <!-- ì‹¤ì œ ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒì°½ -->
                        </div>

                        <!-- í…ìŠ¤íŠ¸ í¸ì§‘ ê°€ëŠ¥í•œ ì˜ì—­: textarea -->
                        <textarea id="content" name="content" class="form-control border" style="min-height: 450px;" required></textarea>
                    </div>

                    <!-- ì œì¶œ ë²„íŠ¼ -->
                    <div class="text-left">
                        <button type="submit" class="btn btn-dark">ë“±ë¡</button> <!-- ë“±ë¡ ë²„íŠ¼ -->
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ íˆ´ë°” ê¸°ëŠ¥ ë° ë°ì´í„° ì „ì†¡ ì¶”ê°€ -->
<script>
    const textarea = document.getElementById('content');

    // ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ êµµê²Œ ë§Œë“œëŠ” í•¨ìˆ˜
    function wrapSelectedText(openTag, closeTag) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);

        if (selectedText) {
            const newText = openTag + selectedText + closeTag;
            textarea.setRangeText(newText, start, end, 'end');
        }
    }

    // Bold ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
    document.getElementById('boldBtn').addEventListener('click', function() {
        wrapSelectedText("<b>", "</b>");  // ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ <b></b> íƒœê·¸ë¡œ ê°ìŒˆ
    });

    // Italic ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
    document.getElementById('italicBtn').addEventListener('click', function() {
        wrapSelectedText("<i>", "</i>");  // ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ <i></i> íƒœê·¸ë¡œ ê°ìŒˆ
    });

    // Underline ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
    document.getElementById('underlineBtn').addEventListener('click', function() {
        wrapSelectedText("<u>", "</u>");  // ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ <u></u> íƒœê·¸ë¡œ ê°ìŒˆ
    });

    // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
    document.getElementById('uploadImageBtn').addEventListener('click', function() {
        document.getElementById('imageInput').click();
    });

    // ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ í›„ textareaì— ì´ë¯¸ì§€ íƒœê·¸ ì‚½ì…
    document.getElementById('imageInput').addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgTag = `<img src="${e.target.result}" alt="Uploaded Image" style="max-width: 100%;">`;
                textarea.value += imgTag;  // textareaì— ì´ë¯¸ì§€ íƒœê·¸ ì¶”ê°€
            };
            reader.readAsDataURL(file);
        }
    });
</script>
